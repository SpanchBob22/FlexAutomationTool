<Window x:Class="FlexAutomator.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Flex Automator" 
        Height="650" Width="950"
        Background="{StaticResource AppBackgroundBrush}"
        FontFamily="{DynamicResource MaterialDesignFont}"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        WindowStartupLocation="CenterScreen"
        WindowStyle="SingleBorderWindow">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="24,24,24,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <materialDesign:PackIcon Kind="RobotOutline" Width="28" Height="28" 
                                       Foreground="{StaticResource MaterialDesignBody}" 
                                       VerticalAlignment="Center" Margin="0,0,12,0" Opacity="0.8"/>

                <TextBlock Text="Сценарії" 
                           FontSize="24" 
                           FontWeight="SemiBold"
                           VerticalAlignment="Center"
                           Foreground="{StaticResource MaterialDesignBody}"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">

                <Button Command="{Binding OpenLogsCommand}"
                        Style="{StaticResource MaterialDesignIconForegroundButton}"
                        ToolTip="Логи"
                        Margin="0,0,8,0"
                        Foreground="{StaticResource MaterialDesignBody}">
                    <materialDesign:PackIcon Kind="TextBoxOutline" Width="22" Height="22"/>
                </Button>

                <Button Command="{Binding OpenSettingsCommand}"
                        Style="{StaticResource MaterialDesignIconForegroundButton}"
                        ToolTip="Налаштування"
                        Margin="0,0,16,0"
                        Foreground="{StaticResource MaterialDesignBody}">
                    <materialDesign:PackIcon Kind="CogOutline" Width="22" Height="22"/>
                </Button>

                <Button Command="{Binding CreateScenarioCommand}"
                        Style="{StaticResource MaterialDesignFloatingActionMiniButton}"
                        Background="{StaticResource MaterialDesignCardBackground}"
                        BorderBrush="{StaticResource SubtleBorderBrush}"
                        Foreground="{StaticResource MaterialDesignBody}"
                        ToolTip="Створити новий сценарій">
                    <materialDesign:PackIcon Kind="Plus" Width="24" Height="24"/>
                </Button>
            </StackPanel>
        </Grid>

        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto" 
                      HorizontalScrollBarVisibility="Disabled">

            <Grid>

                <ItemsControl ItemsSource="{Binding Scenarios}"
                              MaxWidth="800"
                              HorizontalAlignment="Center"
                              Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Grid}}"
                              Margin="24,0,24,24">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <materialDesign:Card Margin="0,0,0,16" 
                                               UniformCornerRadius="8"
                                               Background="{StaticResource MaterialDesignCardBackground}"
                                               BorderBrush="{StaticResource SubtleBorderBrush}"
                                               BorderThickness="1">

                                <materialDesign:Card.Effect>
                                    <DropShadowEffect BlurRadius="10" Direction="270" ShadowDepth="3" Opacity="0.3" Color="Black"/>
                                </materialDesign:Card.Effect>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="4"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <Border Grid.Column="0" Background="{Binding Color}" CornerRadius="2,0,0,2"/>

                                    <StackPanel Grid.Column="1" 
                                              Margin="16,12"
                                              Cursor="Hand"
                                              Background="Transparent"
                                              MouseLeftButtonDown="Scenario_Click">

                                        <TextBlock Text="{Binding Name}" 
                                                 FontSize="16" 
                                                 FontWeight="Medium"
                                                 Foreground="{StaticResource MaterialDesignBody}"/>

                                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0" Opacity="0.5">
                                            <materialDesign:PackIcon Kind="ClockTimeFourOutline" Width="12" Height="12" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                            <TextBlock Text="{Binding LastExecuted, TargetNullValue='Очікування запуску', StringFormat='{}{0:dd.MM.yyyy HH:mm}'}" 
                                                     FontSize="12" 
                                                     VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="10,0">
                                        <ToggleButton IsChecked="{Binding IsActive}"
                                                    Style="{StaticResource MaterialDesignSwitchToggleButton}"
                                                    ToolTip="Активувати/Деактивувати"
                                                    Command="{Binding DataContext.ToggleActiveCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"/>
                                    </StackPanel>

                                    <Button Grid.Column="3"
                                          Command="{Binding DataContext.DeleteScenarioCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                          CommandParameter="{Binding}"
                                          Style="{StaticResource MaterialDesignIconForegroundButton}"
                                          Foreground="#B0B0B0"
                                          ToolTip="Видалити"
                                          Margin="0,0,8,0">
                                        <Button.Resources>
                                            <Style TargetType="materialDesign:PackIcon">
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="#EF5350"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Resources>
                                        <materialDesign:PackIcon Kind="TrashCanOutline" Width="20" Height="20"/>
                                    </Button>
                                </Grid>
                            </materialDesign:Card>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Grid>
        </ScrollViewer>
    </Grid>
</Window>